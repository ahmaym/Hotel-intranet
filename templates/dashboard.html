{% extends "base.html" %}
{% block content %}
<style>
  .welcome-box {
    background: linear-gradient(135deg, #73a4dd 0%, #1d4294 100%);
    color: white;
    padding: 30px 20px;
    border-radius: 12px;
    margin-bottom: 30px;
    text-align: center;
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
  }

  .welcome-box h4 {
    margin: 0 0 10px 0;
    font-size: 28px;
    font-weight: 700;
  }

  .welcome-box p {
    margin: 0;
    font-size: 14px;
    opacity: 0.9;
  }

  .content-section h5 {
    font-size: 18px;
    font-weight: 600;
    color: #2c3e50;
    margin: 25px 0 16px 0;
    border-bottom: 2px solid #667eea;
    padding-bottom: 10px;
  }

  .post-card {
    background: #fff;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
    border-left: 4px solid #667eea;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
  }

  .post-card:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    transform: translateY(-2px);
  }

  .post-card.announcement {
    border-left-color: #f5576c;
  }

  .post-card h6 {
    margin: 0 0 8px 0;
    color: #2c3e50;
    font-size: 16px;
    font-weight: 600;
  }

  .post-card p {
    margin: 0 0 10px 0;
    color: #555;
    font-size: 14px;
    line-height: 1.5;
  }

  .post-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
    color: #999;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #ecf0f1;
  }

  .post-author {
    font-weight: 600;
    color: #667eea;
  }

  .birthdays-section {
    background: linear-gradient(135deg, #dcfce7 0%, #c8e6c9 100%);
    border-left: 4px solid #28a745;
  }

  .birthdays-section h6 {
    color: #1b5e20;
    font-weight: 600;
  }

  .birthdays-section ul {
    margin: 0;
    padding-left: 20px;
  }

  .birthdays-section li {
    color: #2e7d32;
    margin: 8px 0;
    font-weight: 500;
  }

  .no-content {
    color: #999;
    font-style: italic;
    padding: 20px;
    text-align: center;
  }

  .post-form {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
  }

  .post-form h5 {
    margin-top: 0;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 16px;
  }

  .form-row.full {
    grid-column: 1 / -1;
  }

  @media (max-width: 768px) {
    .form-row {
      grid-template-columns: 1fr;
    }
  }

  .form-group {
    margin-bottom: 16px;
  }

  .form-actions {
    display: flex;
    gap: 12px;
    margin-top: 16px;
  }

  .btn-group {
    display: flex;
    gap: 8px;
    margin-top: 10px;
  }
</style>

<div class="welcome-box">
  <h4> Welcome {{ session['username'] }}</h4>
  <p> {{ session['role'] | capitalize }} |  Department: {{ session['department'] }}</p>
</div>

<div class="content-section">
  {% if role == 'admin' or ('posts' in features_list) or ('announcements' in features_list) %}
    <div class="post-form">
      <h5>ğŸ“¢ Post Announcement</h5>
      <form method="post" action="{{ url_for('dashboard') }}">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ğŸ“ Content Type</label>
            <select name="type" class="input">
              {% if role == 'admin' or 'announcements' in features_list %}
                <option value="announcement">ğŸ“¢ Announcement</option>
              {% endif %}
              {% if role == 'admin' or 'posts' in features_list %}
                <option value="post">ğŸ“„ Post</option>
              {% endif %}
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">ğŸ“Œ Title</label>
            <input type="text" name="title" class="input" placeholder="Enter title..." required>
          </div>
        </div>
        <div class="form-row full">
          <div class="form-group">
            <label class="form-label">âœï¸ Content</label>
            <textarea name="content" class="textarea" rows="3" placeholder="Write content..." required></textarea>
          </div>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">ğŸ“¤ Publish</button>
          <a href="{{ url_for('tickets') }}" class="btn btn-warning">ğŸŸï¸ Create IT Ticket</a>
        </div>
      </form>
    </div>
  {% endif %}

  <h5>ğŸ“¢ Announcements</h5>
  {% if announcements %}
    {% for a in announcements %}
      <div class="post-card announcement">
        <h6>{{ a['title'] }}</h6>
        <p>{{ a['content'] }}</p>
        <div class="post-meta">
          <span><span class="post-author">ğŸ‘¤ {{ a['author_username'] }}</span> | ğŸ“… {{ a['created_at'] }}</span>
          {% if 'delete' in features_list %}
            <form action="{{ url_for('delete_announcement', ann_id=a['id']) }}" method="POST" style="margin: 0;">
              <button type="submit" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;" onclick="return confirm('Are you sure you want to delete?')">ğŸ—‘ï¸ Delete</button>
            </form>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="no-content">No announcements at the moment</div>
  {% endif %}

  <h5>ğŸ“„ Latest Posts</h5>
  {% if posts %}
    {% for p in posts %}
      <div class="post-card">
        <h6>{{ p['title'] }}</h6>
        <p>{{ p['content'] }}</p>
        <div class="post-meta">
          <span><span class="post-author">ğŸ‘¤ {{ p['author_username'] }}</span> | ğŸ“… {{ p['created_at'] }}</span>
          {% if role == 'admin' %}
            <form action="{{ url_for('delete_post', post_id=p['id']) }}" method="POST" style="margin: 0;">
              <button type="submit" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;" onclick="return confirm('Are you sure you want to delete?')">ğŸ—‘ï¸ Delete</button>
            </form>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="no-content">No posts at the moment</div>
  {% endif %}

  <div class="post-card birthdays-section">
    <h6>ğŸ‚ Today's Birthdays</h6>
    {% if birthdays %}
      <ul class="mb-0">
        {% for b in birthdays %}
          <li>ğŸ‰ {{ b['name'] }} â€” {{ b['job_title'] }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p style="margin: 0; color: #2e7d32;">No birthdays today</p>
    {% endif %}
  </div>
</div>
{% endblock %}
